// Copyright (c) 2022 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import t from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-bigint-support@esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@esm/index.mjs";import e from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-accessor@esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-bytes-per-element@esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-iteration-order@esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-strides2order@esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-minmax-view-buffer-index@esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/complex-real@esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/complex-imag@esm/index.mjs";import _ from"https://cdn.jsdelivr.net/gh/stdlib-js/string-replace@esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-little-endian@esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/array-buffer@esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/array-dataview@esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/bigint-ctor@esm/index.mjs";import{enum as l}from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-dtypes@esm/index.mjs";import{enum as u}from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-orders@esm/index.mjs";import{enum as c}from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-index-modes@esm/index.mjs";import g from"https://cdn.jsdelivr.net/gh/stdlib-js/array-uint8@esm/index.mjs";import{assign as b}from"https://cdn.jsdelivr.net/gh/stdlib-js/number-float64-base-to-int64-bytes@esm/index.mjs";function y(t,s){return s&&(2===t||3===t)}function j(t,s){return s&&(1===t||3===t)}var O={int8:"new Int8Array( [ {{data}} ] )",uint8:"new Uint8Array( [ {{data}} ] )",uint8c:"new Uint8ClampedArray( [ {{data}} ] )",int16:"new Int16Array( [ {{data}} ] )",uint16:"new Uint16Array( [ {{data}} ] )",int32:"new Int32Array( [ {{data}} ] )",uint32:"new Uint32Array( [ {{data}} ] )",float32:"new Float32Array( [ {{data}} ] )",float64:"new Float64Array( [ {{data}} ] )",generic:"[ {{data}} ]",binary:"new Buffer( [ {{data}} ] )",complex64:"new Complex64Array( [ {{data}} ] )",complex128:"new Complex128Array( [ {{data}} ] )"};var v=l(),x=u(),I=c();var U=l(),w=u(),A=c();function E(t,s,e,o,f,_){var a,d,m,p,l;if(!(this instanceof E))return new E(t,s,e,o,f,_);for(p=1,l=0;l<e.length;l++)p*=e[l];return d=s.BYTES_PER_ELEMENT?s.BYTES_PER_ELEMENT*p:null,this._byteLength=d,this._bytesPerElement=i(t),this._buffer=s,this._dtype=t,this._length=p,this._ndims=e.length,this._offset=f,this._order=_,this._shape=e,this._strides=o,this._accessors=Boolean(s.get&&s.set),this._iterationOrder=r(o),a=function(t,s,e,i,r){var n;return 0!==t&&0!==r&&t===(n=h(s,e,i))[1]-n[0]+1}(p,e,o,f,this._iterationOrder),m=n(o),this._flags={ROW_MAJOR_CONTIGUOUS:j(m,a),COLUMN_MAJOR_CONTIGUOUS:y(m,a),READONLY:!1},this.__meta_dataview__=null,this}s(E,"name","ndarray"),e(E.prototype,"byteLength",(function(){return this._byteLength})),e(E.prototype,"BYTES_PER_ELEMENT",(function(){return this._bytesPerElement})),e(E.prototype,"data",(function(){return this._buffer})),e(E.prototype,"dtype",(function(){return this._dtype})),e(E.prototype,"flags",(function(){return{ROW_MAJOR_CONTIGUOUS:(t=this._flags).ROW_MAJOR_CONTIGUOUS,COLUMN_MAJOR_CONTIGUOUS:t.COLUMN_MAJOR_CONTIGUOUS,READONLY:t.READONLY};var t})),e(E.prototype,"length",(function(){return this._length})),e(E.prototype,"ndims",(function(){return this._ndims})),e(E.prototype,"offset",(function(){return this._offset})),e(E.prototype,"order",(function(){return this._order})),e(E.prototype,"shape",(function(){return this._shape.slice()})),e(E.prototype,"strides",(function(){return this._strides.slice()})),s(E.prototype,"get",(function(){var t,s;for(t=this._offset,s=0;s<arguments.length;s++)t+=this._strides[s]*arguments[s];return this._accessors?this._buffer.get(t):this._buffer[t]})),s(E.prototype,"iget",(function(t){var s,e,i,r,n,h;if(0===(i=this._ndims))return this._accessors?this._buffer.get(this._offset):this._buffer[this._offset];if(this._flags.ROW_MAJOR_CONTIGUOUS||this._flags.COLUMN_MAJOR_CONTIGUOUS){if(1===this._iterationOrder)return this._accessors?this._buffer.get(this._offset+t):this._buffer[this._offset+t];if(-1===this._iterationOrder)return this._accessors?this._buffer.get(this.offset-t):this._buffer[this._offset-t]}if(e=this._shape,s=this._strides,r=this._offset,"column-major"===this._order){for(h=0;h<i;h++)t-=n=t%e[h],t/=e[h],r+=n*s[h];return this._accessors?this._buffer.get(r):this._buffer[r]}for(h=i-1;h>=0;h--)t-=n=t%e[h],t/=e[h],r+=n*s[h];return this._accessors?this._buffer.get(r):this._buffer[r]})),s(E.prototype,"set",(function(){var t,s;for(t=this._offset,s=0;s<arguments.length-1;s++)t+=this._strides[s]*arguments[s];return this._accessors?this._buffer.set(arguments[s],t):this._buffer[t]=arguments[s],this})),s(E.prototype,"iset",(function(t,s){var e,i,r,n,h,o;if(0===(r=this._ndims))return this._accessors?this._buffer.set(t,this._offset):this._buffer[this._offset]=t,this;if(this._flags.ROW_MAJOR_CONTIGUOUS||this._flags.COLUMN_MAJOR_CONTIGUOUS){if(1===this._iterationOrder)return this._accessors?this._buffer.set(s,this._offset+t):this._buffer[this._offset+t]=s,this;if(-1===this._iterationOrder)return this._accessors?this._buffer.set(s,this._offset-t):this._buffer[this._offset-t]=s,this}if(i=this._shape,e=this._strides,n=this._offset,"column-major"===this._order){for(o=0;o<r;o++)t-=h=t%i[o],t/=i[o],n+=h*e[o];return this._accessors?this._buffer.set(s,n):this._buffer[n]=s,this}for(o=r-1;o>=0;o--)t-=h=t%i[o],t/=i[o],n+=h*e[o];return this._accessors?this._buffer.set(s,n):this._buffer[n]=s,this})),s(E.prototype,"toString",(function(){var t,s,e,i,r,n,h;if(s=this._shape.length,i="ndarray( '"+(r=this._dtype)+"', ",t="",this._length<=100)if("complex64"===r||"complex128"===r)for(h=0;h<this._length;h++)n=this.iget(h),t+=o(n)+", "+f(n),h<this._length-1&&(t+=", ");else for(h=0;h<this._length;h++)t+=this.iget(h),h<this._length-1&&(t+=", ");else{if("complex64"===r||"complex128"===r)for(h=0;h<3;h++)n=this.iget(h),t+=o(n)+", "+f(n),h<2&&(t+=", ");else for(h=0;h<3;h++)t+=this.iget(h),h<2&&(t+=", ");if(t+=", ..., ","complex64"===r||"complex128"===r)for(h=2;h>=0;h--)n=this.iget(this._length-1-h),t+=o(n)+", "+f(n),h>0&&(t+=", ");else for(h=2;h>=0;h--)t+=this.iget(this._length-1-h),h>0&&(t+=", ")}if(e=O[this.dtype],i+=_(e,"{{data}}",t),i+=", ",i+=0===s?"[]":"[ "+this._shape.join(", ")+" ]",i+=", ",i+="[ ",0===s)i+="0";else for(h=0;h<s;h++)this._strides[h]<0?i+=-this._strides[h]:i+=this._strides[h],h<s-1&&(i+=", ");return i+=" ]",i+=", ",i+="0",i+=", ",i+="'"+this._order+"'",i+=" )"})),s(E.prototype,"toJSON",(function(){var t,s,e,i;for(s=this._length,(t={}).type="ndarray",t.dtype=this.dtype,t.flags={READONLY:this._flags.READONLY},t.order=this._order,t.shape=this._shape.slice(),t.strides=this._strides.slice(),i=0;i<s;i++)t.strides[i]<0&&(t.strides[i]*=-1);if(t.data=[],"complex64"===t.dtype||"complex128"===t.dtype)for(i=0;i<s;i++)e=this.iget(i),t.data.push(o(e),f(e));else for(i=0;i<s;i++)t.data.push(this.iget(i));return t})),s(E.prototype,"__array_meta_dataview__",t()?function(){var t,s,e,i,r,n,h,o,f,_,l,u,c,g;if(f=this._mode||"throw",h=this._submode||[f],e=33+16*(u=this._ndims)+(c=h.length),(o=this.__meta_dataview__)&&o.byteLength===e)return o;for(o=new m(new d(e)),r=this._shape,n=this._strides,i=this._dtype,t=this._bytesPerElement,_=0,o.setInt8(_,a?1:0),_+=1,o.setInt16(_,v[i],a),_+=2,o.setBigInt64(_,p(u),a),l=8*u,_+=8,g=0;g<u;g++)o.setBigInt64(_,p(r[g]),a),o.setBigInt64(_+l,p(n[g]*t),a),_+=8;for(_+=l,o.setBigInt64(_,p(this._offset*t),a),_+=8,o.setInt8(_,x[this._order]),_+=1,o.setInt8(_,I[f]),_+=1,o.setBigInt64(_,p(c),a),_+=8,g=0;g<c;g++)o.setInt8(_,I[h[g]]),_+=1;return s=0,s|=this._flags.READONLY?4:0,o.setInt32(_,s,a),this.__meta_dataview__=o,o}:function(){var t,s,e,i,r,n,h,o,f,_,p,l,u,c,y;if(_=this._mode||"throw",o=this._submode||[_],i=33+16*(u=this._ndims)+(c=o.length),(f=this.__meta_dataview__)&&f.byteLength===i)return f;for(f=new m(new d(i)),s=new g(f.buffer),n=this._shape,h=this._strides,r=this._dtype,t=this._bytesPerElement,p=0,f.setInt8(p,a?1:0),p+=1,f.setInt16(p,U[r],a),b(u,s,1,p+=2),l=8*u,p+=8,y=0;y<u;y++)b(n[y],s,1,p),b(h[y]*t,s,1,p+l),p+=8;for(p+=l,b(this._offset*t,s,1,p),p+=8,f.setInt8(p,w[this._order]),p+=1,f.setInt8(p,A[_]),b(c,s,1,p+=1),p+=8,y=0;y<c;y++)f.setInt8(p,A[o[y]]),p+=1;return e=0,e|=this._flags.READONLY?4:0,f.setInt32(p,e,a),this.__meta_dataview__=f,f});export{E as default};
//# sourceMappingURL=index.mjs.map
